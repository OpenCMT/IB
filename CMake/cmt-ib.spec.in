Summary: Cosmic Muon Tomography analysis libraries
Name: cmt-ib
Version: @PKGVERSION@
Release: @PKGRELEASE@%{?dist}
License: EUROPEAN UNION PUBLIC LICENCE v. 1.2
Vendor: INFN
URL: https://github.com/OpenCMT/IB
Group: Development/Libraries
BuildArch: %{_arch}
BuildRequires: cmake3
BuildRequires: cmt-ulib-devel
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
AutoReqProv: yes
Source: %{name}-%{version}.tar.gz

%description
This package contains the analysis toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%prep
%setup -c
rm -rf %{buildroot}
mkdir -p %{buildroot}

%build
mkdir %{_builddir}/%{name}-%{version}/build
cd %{_builddir}/%{name}-%{version}/build
cmake3 -DCMAKE_INSTALL_PREFIX=%{buildroot}/usr \
       -DULIB_USE_QT5=OFF \
       -DPACKAGE_INSTALL_LIB_DIR=%{buildroot}/usr/lib64 \
       %{_builddir}/%{name}-%{version}
make

%install
cd %{_builddir}/%{name}-%{version}/build
make install
#workaround 1
mv %{buildroot}/usr/lib/* %{buildroot}/usr/lib64
rm -rf %{buildroot}/usr/lib
# workaround 2
sed -i 's|%{buildroot}/usr|/usr|g' %{buildroot}/usr/lib64/cmake/mutom-%{version}/IBTargets.cmake
sed -i 's|%{buildroot}/usr|/usr|g' %{buildroot}/usr/lib64/cmake/mutom-%{version}/IBTargets-relwithdebinfo.cmake


%clean
rm -rf %{buildroot}

%files
%defattr(-,root,root)
/usr/lib64/libmutomIB.so.0.2

%package devel
Summary: Cosmic Muon Tomography analysis libraries, development files
Requires: %{name}
Requires: cmt-ulib-devel

%description devel
This package contains the analysis toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%files devel
%defattr(-,root,root)
/usr/lib64/libmutomIB.so
/usr/lib64/cmake/mutom-0.2/*.cmake
%dir /usr/include/mutom-0.2/IB
/usr/include/mutom-0.2/IB/*.h
/usr/include/mutom-0.2/IB/*.hpp

%package binutils
Summary: Cosmic Muon Tomography analysis libraries, bin files
Requires: %{name}

%description binutils
This package contains the analysis toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%files binutils
%defattr(-,root,root)
/usr/bin/IB_abtrim
/usr/bin/IB_abtrimu
/usr/bin/IB_bilateral
/usr/bin/IB_median
/usr/bin/IB_scale
/usr/bin/IB_spr
/usr/bin/IB_lnlROCBuilder
/usr/bin/IB_lnlROCBuilder2
/usr/bin/IB_portal3x6x5ROCBuilder
/usr/bin/IB_ROCScaleToMidpt
/usr/bin/IB_ROCScaleToMidAwo
/usr/bin/IB_ROCScaleToMideff
#/usr/bin/IB_ROCPlot
/usr/bin/misureLNL

%package doc
Summary: Cosmic Muon Tomography analysis libraries, document files

%description doc
This package contains the analysis toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%files doc
%defattr(-,root,root)
%dir /usr/share/doc/mutom-0.2/html
%dir /usr/share/doc/mutom-0.2/html/search
/usr/share/doc/mutom-0.2/html/annotated.html
/usr/share/doc/mutom-0.2/html/class*.html
/usr/share/doc/mutom-0.2/html/files.html
/usr/share/doc/mutom-0.2/html/functions*.html
/usr/share/doc/mutom-0.2/html/globals*.html
/usr/share/doc/mutom-0.2/html/hierarchy.html
/usr/share/doc/mutom-0.2/html/_i_b_*.html
/usr/share/doc/mutom-0.2/html/index.html
/usr/share/doc/mutom-0.2/html/namespace*.html
/usr/share/doc/mutom-0.2/html/struct*.html
/usr/share/doc/mutom-0.2/html/*.css
/usr/share/doc/mutom-0.2/html/*.png
/usr/share/doc/mutom-0.2/html/*.js
/usr/share/doc/mutom-0.2/html/search/*.html
/usr/share/doc/mutom-0.2/html/search/*.css
/usr/share/doc/mutom-0.2/html/search/*.png
/usr/share/doc/mutom-0.2/html/search/*.js

#
# TODO split cmt-ib-debuginfo package (bins and libs)
#

%changelog
* Tue Dec 04 2018 Paolo Andreetto <paolo.andreetto@pd.infn.it> - 0.2.1-1
- Repackaging for CentOS 7

